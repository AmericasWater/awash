real mu2;
real<lower=0> sigma1;
real<lower=0> sigma2;
}
model {
sigma1 ~ uniform(0, 1000);
sigma2 ~ uniform(0, 1000);
mu1 ~ uniform(0, 2000);
mu2 ~ uniform(0, 2000);
y1 ~ normal(mu1, sigma1);
y2 ~ normal(mu2, sigma2);
}
generated quantities {
}
"
diet_milk <- c(651, 679, 374, 601, 401, 609, 767, 709, 704, 679)
normal_milk <- c(798, 1139, 529, 609, 553, 743, 151, 544, 488, 555, 257, 692, 678, 675, 538)
data_list <- list(y1 = diet_milk, y2 = normal_milk, n1 = length(diet_milk), n2 = length(normal_milk))
# Compiling and producing posterior samples from the model.
stan_samples <- stan(model_code = model_string, data = data_list)
# Plotting and summarizing the posterior distribution
stan_samples
plot(stan_samples)
s <- as.data.frame(stan_samples)
head(s)
# The probability that the diet makes cows produce more milk on average
mu_diff = s$mu1 - s$mu2
mean(s$mu1 > s$mu2)
mean(mu_diff > 0)
model_string <- "
data {
# Number of data points
int n1;
int n2;
# Milk production
vector[n1] y1;
vector[n2] y2;
}
parameters {
real mu1;
real mu2;
real<lower=0> sigma1;
real<lower=0> sigma2;
}
model {
sigma1 ~ uniform(0, 1000);
sigma2 ~ uniform(0, 1000);
mu1 ~ uniform(0, 2000);
mu2 ~ uniform(0, 2000);
y1 ~ student_t(3, mu1, sigma1);;
y2 ~ student_t(3, mu2, sigma2);;
}
generated quantities {
}
"
diet_milk <- c(651, 679, 374, 601, 4000, 401, 609, 767, 3890, 704, 679)
normal_milk <- c(798, 1139, 529, 609, 553, 743, 3,151, 544, 488, 15, 257, 692, 678, 675, 538)
data_list <- list(y1 = diet_milk, y2 = normal_milk, n1 = length(diet_milk), n2 = length(normal_milk))
# Compiling and producing posterior samples from the model.
stan_samples <- stan(model_code = model_string, data = data_list)
# Plotting and summarizing the posterior distribution
stan_samples
plot(stan_samples)
s <- as.data.frame(stan_samples)
head(s)
# The probability that the diet makes cows produce more milk on average
mu_diff = s$mu1 - s$mu2
mean(s$mu1 > s$mu2)
mean(mu_diff > 0)
# Plotting distribution of the difference between theta1 and theta2
hist(s$mu2 - s$mu1)
model_string <- "
data {
# Number of data points
int n1;
int n2;
# Milk production
vector[n1] y1;
vector[n2] y2;
}
parameters {
real<lower=0> lambda1;
real<lower=0> lambda2;
}
model {
lambda1 ~ uniform(0, 10);
lambda2 ~ uniform(0, 10);
y1 ~ poisson(lambda1);
y2 ~ poisson(lambda2);
}
generated quantities {
}
"
diet_eggs <- c(6, 4, 2, 3, 4, 3, 0, 4, 0, 6, 3)
normal_eggs <- c(4, 2, 1, 1, 2, 1, 2, 1, 3, 2, 1)
data_list <- list(y1 = diet_eggs, y2 = normal_eggs, n1 = length(diet_eggs), n2 = length(normal_eggs))
# Compiling and producing posterior samples from the model.
stan_samples <- stan(model_code = model_string, data = data_list)
model_string <- "
data {
# Number of data points
int n1;
int n2;
# Milk production
int y1[n1];
int y2[n2];
}
parameters {
real<lower=0> lambda1;
real<lower=0> lambda2;
}
model {
lambda1 ~ uniform(0, 10);
lambda2 ~ uniform(0, 10);
y1 ~ poisson(lambda1);
y2 ~ poisson(lambda2);
}
generated quantities {
}
"
diet_eggs <- c(6, 4, 2, 3, 4, 3, 0, 4, 0, 6, 3)
normal_eggs <- c(4, 2, 1, 1, 2, 1, 2, 1, 3, 2, 1)
data_list <- list(y1 = diet_eggs, y2 = normal_eggs, n1 = length(diet_eggs), n2 = length(normal_eggs))
# Compiling and producing posterior samples from the model.
stan_samples <- stan(model_code = model_string, data = data_list)
# Plotting and summarizing the posterior distribution
stan_samples
plot(stan_samples)
s <- as.data.frame(stan_samples)
head(s)
# The probability that the diet makes chicken produce more eggs on average
lambda_diff = s$lambda1 - s$lambda2
mean(mu_diff > 0)
# Plotting distribution of the difference between theta1 and theta2
hist(s$mu2 - s$mu1)
# The probability that the diet makes chicken produce more eggs on average
lambda_diff = s$lambda1 - s$lambda2
mean(lambda_diff > 0)
# Plotting distribution of the difference between theta1 and theta2
hist(lambda_diff)
d <- data.frame(
milk = c(651, 679, 374, 601, 401, 609, 767, 709, 704, 679, 798, 1139,
529, 609, 553, 743, 151, 544, 488, 555, 257, 692, 678, 675, 538),
group = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2))
data_list <- list(y = d$milk, x = d$group, n = length(d$milk),
n_groups = max(d$group))
d <- data.frame(
milk = c(651, 679, 374, 601, 401, 609, 767, 709, 704, 679, 798, 1139,
529, 609, 553, 743, 151, 544, 488, 555, 257, 692, 678, 675, 538),
group = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2,
2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2))
data_list1 <- list(y = d$milk, x = d$group, n = length(d$milk),
n_groups = max(d$group))
diet_milk <- c(651, 679, 374, 601, 401, 609, 767, 709, 704, 679)
normal_milk <- c(798, 1139, 529, 609, 553, 743, 151, 544, 488, 555, 257, 692, 678, 675, 538)
data_list <- list(y1 = diet_milk, y2 = normal_milk, n1 = length(diet_milk), n2 = length(normal_milk))
# Compiling and producing posterior samples from the model.
stan_samples <- stan(model_code = model_string, data = data_list)
model_string <- "
data {
# Number of data points
int n;
# Number of groups
int n_groups;
# Milk production
vector[n] y;
}
parameters {
vector[n_groups] mu;
vector[n_groups] sigma;
}
model {
mu ~ uniform(0, 2000);
sigma ~ uniform(0, 1000);
#for(i in 1:n) {
#  y[i] ~ normal( mu[x[i]], sigma[x[i]] )
#}
y ~ normal( mu[x], sigma[x] );
}
generated quantities {
}
"
d <- data.frame(
milk = c(651, 679, 374, 601, 401, 609, 767, 709, 704, 679, 798, 1139, 529,
609, 553, 743, 151, 544, 488, 555, 257, 692, 678, 675, 538, 1061,
721, 595, 784, 877, 562, 800, 684, 741, 516),
group = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3))
data_list <- list(y = d$milk, x = d$group, n = length(d$milk),
n_groups = max(d$group))
# Compiling and producing posterior samples from the model.
stan_samples <- stan(model_code = model_string, data = data_list)
model_string <- "
data {
# Number of data points
int n;
# Number of groups
int n_groups;
# Mapping observations to group
int x[n];
# Milk production
vector[n] y;
}
parameters {
vector[n_groups] mu;
vector[n_groups] sigma;
}
model {
mu ~ uniform(0, 2000);
sigma ~ uniform(0, 1000);
#for(i in 1:n) {
#  y[i] ~ normal( mu[x[i]], sigma[x[i]] )
#}
y ~ normal( mu[x], sigma[x] );
}
generated quantities {
}
"
# Compiling and producing posterior samples from the model.
stan_samples <- stan(model_code = model_string, data = data_list)
# Plotting and summarizing the posterior distribution
stan_samples
plot(stan_samples)
model_string <- "
data {
# Number of data points
int n;
# Number of groups
int n_groups;
# Mapping observations to group
int x[n];
# Milk production
vector[n] y;
}
parameters {
vector[n_groups] mu;
vector<lower=0>[n_groups] sigma;
}
model {
mu ~ uniform(0, 2000);
sigma ~ uniform(0, 1000);
#for(i in 1:n) {
#  y[i] ~ normal( mu[x[i]], sigma[x[i]] )
#}
y ~ normal( mu[x], sigma[x] );
}
generated quantities {
}
"
d <- data.frame(
milk = c(651, 679, 374, 601, 401, 609, 767, 709, 704, 679, 798, 1139, 529,
609, 553, 743, 151, 544, 488, 555, 257, 692, 678, 675, 538, 1061,
721, 595, 784, 877, 562, 800, 684, 741, 516),
group = c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2,
2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3))
data_list <- list(y = d$milk, x = d$group, n = length(d$milk),
n_groups = max(d$group))
# Compiling and producing posterior samples from the model.
stan_samples <- stan(model_code = model_string, data = data_list)
# Plotting and summarizing the posterior distribution
stan_samples
plot(stan_samples)
s <- as.data.frame(stan_samples)
head(s)
# The probability that the diet makes cows produce more milk on average
mu_diff31 = s$mu[3] - s$mu[1]
mu_diff32 = s$mu[3] - s$mu[2]
mean(mu_diff31)
mean(mu_diff32)
# The probability that the diet makes cows produce more milk on average
mu_diff31 = s$mu[3] - s$mu[1]
mu_diff32 = s$mu[3] - s$mu[2]
mean(mu_diff31, na.rm=T)
mean(mu_diff32, na.rm=T)
s$mu[3]
s
# The probability that the diet makes cows produce more milk on average
mu_diff31 = s$`mu[3]` - s$`mu[1]`
mu_diff32 = s$`mu[3]` - s$`mu[2]`
mean(mu_diff31, na.rm=T)
mean(mu_diff32, na.rm=T)
d <- data.frame(milk = c(685, 691, 476, 1151, 879, 725, 1190, 1107, 809, 539,
298, 805, 820, 498, 1026, 1217, 1177, 684, 1061, 834),
hours = c(3, 7, 6, 10, 6, 5, 10, 11, 9, 3, 6, 6, 3, 5, 8, 11,
12, 9, 5, 5))
data_list <- list(y = d$milk, h = d$hours, n = length(d$milk))
model_string <- "
data {
# Number of data points
int n;
# Milk production
vector[n] y;
# Sunshine hours
vector[n] h;
}
parameters {
real mu;
real beta;
vector<lower=0>[n_groups] sigma;
}
model {
mu ~ uniform(0, 2000);
beta ~ uniform(0, 2000);
sigma ~ uniform(0, 1000);
y ~ normal( mu+h*beta, sigma );
}
generated quantities {
}
"
# Compiling and producing posterior samples from the model.
stan_samples <- stan(model_code = model_string, data = data_list)
model_string <- "
data {
# Number of data points
int n;
# Milk production
vector[n] y;
# Sunshine hours
vector[n] h;
}
parameters {
real mu;
real beta;
real<lower=0> sigma;
}
model {
mu ~ uniform(0, 2000);
beta ~ uniform(0, 2000);
sigma ~ uniform(0, 1000);
y ~ normal( mu+h*beta, sigma );
}
generated quantities {
}
"
# Compiling and producing posterior samples from the model.
stan_samples <- stan(model_code = model_string, data = data_list)
# Plotting and summarizing the posterior distribution
stan_samples
plot(stan_samples)
s <- as.data.frame(stan_samples)
head(s)
plot(d$hours, d$milk, xlim=c(0, 13), ylim = c(0, 1300))
# Adding a sample of the posterior draws to the plot in order to visualize the
# uncertainty of the regression line.
s <- as.data.frame(stan_samples)
for(i in sample(nrow(s), size = 20)) {
abline(s[i,"beta0"], s[i,"beta1"], col = "gray")
}
plot(d$hours, d$milk, xlim=c(0, 13), ylim = c(0, 1300))
# Adding a sample of the posterior draws to the plot in order to visualize the
# uncertainty of the regression line.
s <- as.data.frame(stan_samples)
for(i in sample(nrow(s), size = 20)) {
abline(s[i,"mu"], s[i,"beta"], col = "gray")
}
library(readr)
NC <- read_delim("north_carolina.tsv.gz", delim = "\t")
load(".RData")
load("NC.RData")
load(".RData")
save(list(NC=NC, stops=stops), file='NC2.RData')
save(NC, file='NC2.RData')
save(stops, file='stops.RData')
knitr::opts_chunk$set(LABEL = TRUE, cache = TRUE, results = "hide", message = FALSE, seed = 12345)
library(rstan)
library(rstanarm)
library(brms)
options(mc.cores = parallel::detectCores())
setwd('C:/Users/luc/Desktop/GR5065/HW6')
load("NC2.RData")
load("stops.RData")
library(dplyr)
NC$n_stop=1
NC %>% group_by(police_department, race) %>%
summarise(n_stops=sum(n_stop), search_conducted=sum(search_conducted), contraband_found=sum(contraband_found, na.rm=T)) -> NC2
data_list <- list(N=nrow(NC2), R=4, D=100, r=as.numeric(factor(NC2$race)), d=as.numeric(factor(NC2$police_department)), n=NC2$n_stops, s=NC2$search_conducted, h=NC2$contraband_found)
# Compiling and producing posterior samples from the model.
stan_samples <- stan(file = "north_carolina_police.stan", data = data_list, chains = 2,iter = 200, control = list(adapt_delta = 0.99, max_treedepth=20))
# Compiling and producing posterior samples from the model.
stan_samples <- stan(file = "north_carolina_police.stan", data = data_list, chains = 2,iter = 200, control = list(adapt_delta = 0.99, max_treedepth=20))
# Compiling and producing posterior samples from the model.
stan_samples <- stan(file = "north_carolina_police.stan", data = data_list, chains = 2,iter = 200, control = list(adapt_delta = 0.8, max_treedepth=10))
# Compiling and producing posterior samples from the model.
stan_samples <- stan(file = "north_carolina_police.stan", data = data_list, chains = 2,iter = 500, control = list(adapt_delta = 0.9, max_treedepth=10))
rstan:::rstudio_stanc("C:/Users/luc/Desktop/GR5065/HW6/interval_regv2.stan")
sm <- rstan::stan_model("C:/Users/luc/Desktop/GR5065/HW6/interval_regv2.stan")
sm
rstan:::rstudio_stanc("C:/Users/luc/Desktop/GR5065/Final/cigarettes_rng.stan")
rstan:::rstudio_stanc("C:/Users/luc/Desktop/GR5065/Final/cigarettes_rng.stan")
rstan:::rstudio_stanc("C:/Users/luc/Desktop/GR5065/Final/cigarettes_rng.stan")
rstan:::rstudio_stanc("C:/Users/luc/Desktop/GR5065/Final/cigarettes_rng.stan")
load('C:/Users/luc/Desktop/awash/data/counties/waternet/waternet.RData')
a=nc_open('C:/Users/luc/Desktop/awash/data/cache/counties/VIC_WB.nc')
library(ncdf4)
a=nc_open('C:/Users/luc/Desktop/awash/data/cache/counties/VIC_WB.nc')
a$var
b=ncvar_get('month')
b=ncvar_get(a, 'month')
b
/
735/12
names(a$var)
a=nc_open('C:/Users/luc/Desktop/awash/data/cache/counties/contributing_runoff_by_gage.nc')
names(a$var)
b=ncvar_get(a, 'totalflow')
b
names(a$var)
ncvar_get(a, 'gage_id')
d=ncvar_get(a, 'gage_id')
d
load('C:/Users/luc/Desktop/awash/data/cache/counties/waternet/waternet.RData')
load('C:/Users/luc/Desktop/awash/data/counties/waternet/waternet.RData')
load('C:/Users/luc/Desktop/awash/data/counties/waternet/countydraws.RData')
load('C:/Users/luc/Desktop/Paleo/LBDA_sf/SF_disagg/results/monthly.disaggregation.Rdata')
load('C:/Users/luc/Desktop/Paleo/LBDA_sf/SF_disagg/results/CONUS/monthly.disaggregation.Rdata')
data=nc_open('C:/Users/luc/Desktop/awash/data/cache/paleo/VIC_WB.nc')
library(ncdf4)
data=nc_open('C:/Users/luc/Desktop/awash/data/cache/paleo/VIC_WB.nc')
names(data$var)
t=ncvar_get(data, 'month')
t
data=nc_open('C:/Users/luc/Desktop/awash/data/cache/counties/VIC_WB.nc')
names(data$var)
t=ncvar_get(data, 'month')
t
load("C:/Users/luc/Desktop/awash/data/counties/waternet/waternet.RData")
## Parameters to change
result_path = paste0("C:/Users/luc/Desktop/awash/analyses/climatevariability/", "analyzereservoir_60yrs_12months/")
start_year=1950
end_year=2009
tstep_py=1
## Load libraries and finish set-up
library(PBSmapping)
library(RColorBrewer)
library(dplyr)
library(ggplot2)
library(ggmap)
library(maps)
library(maptools)
library(tmap)      # package for plotting
library(readxl)    # for reading Excel
library(tmaptools)
data(wrld_simpl)
setwd(result_path)
nyears=end_year-start_year+1
time_ind0 <- (1:nyears)*tstep_py
dir.create('plots', showWarnings=F)
# - county fips, state fips, region indexes
mastercounties <- read.csv("../../../data/global/counties.csv")
fips <- matrix(mastercounties$fips, nrow = 3109, ncol = length(time_ind0)) %>% as.vector()
time_ind <- t(matrix(time_ind0, nrow = length(time_ind0), ncol = 3109)) %>% as.vector() %>% as.factor()
state_ind <- matrix(mastercounties$state, nrow = 3109, ncol = max(time_ind0)) %>% as.vector()
region_ind <- state_ind
region_ind[which(region_ind %in% c("CT", "ME", "MA", "NH", "RI", "VT"))] <- "I"
region_ind[which(region_ind %in% c("NJ", "NY"))] <- "II"
region_ind[which(region_ind %in% c("DE", "DC", "MD", "PA", "VA", "WV"))] <- "III"
region_ind[which(region_ind %in% c("AL", "FL", "GA", "KY", "MS", "NC", "SC", "TN"))] <- "IV"
region_ind[which(region_ind %in% c("IL", "IN", "MI", "MN", "OH", "WI"))] <- "V"
region_ind[which(region_ind %in% c("AR", "LA", "NM", "OK", "TX"))] <- "VI"
region_ind[which(region_ind %in% c("IA", "KS", "MO", "NE"))] <- "VII"
region_ind[which(region_ind %in% c("CO", "MT", "ND", "SD", "UT", "WY"))] <- "VIII"
region_ind[which(region_ind %in% c("AZ", "CA", "NV"))] <- "IX"
region_ind[which(region_ind %in% c("ID", "OR", "WA"))] <- "X"
# Read-in reservoir data
resdf <- read.csv("../../../data/counties/reservoirs/allreservoirs.csv")
# Read-in results
captures <- as.matrix(read.csv("captures.csv", header = F)) # reservoir level
storage <- as.matrix(read.csv("storage.csv", header = F)) # reservoir level
smax <- matrix(as.matrix(read.csv("storagecapmax.csv", header = F)), nrow = dim(captures)[1], ncol = dim(captures)[2])#*(1-0.05)^12
failuresin <- read.csv("failuresin.csv", header = F)
failurecon <- read.csv("failurecon.csv", header = F)
dem=read.csv("dem_tot.csv", header=F)
# Separate captures and releases
release <- captures
release[which(release > 0)] <- 0
proprel <- release/smax
proprel[which(smax == 0)] <- 0
hist(rowSums(proprel), breaks = 10)
capture <- captures
capture[which(capture < 0)] <- 0
propcapture <- capture/smax
propcapture[which(smax == 0)] <- 0
hist(propcapture, breaks = 100)
sum(rowMeans(propcapture)<0.01)/length(rowMeans(propcapture))*100
mpctcap <- 100*rowMeans(propcapture)
resdf$state=state_ind[match(resdf$fips, fips[1:3109])]
## Basic CONUS reservoir maps
map <- map_data("usa")
png(paste0('plots/reservoir_map.png'), height = 800, width = 1200)
p <- ggplot()+
geom_polygon(data=map, aes(x=long, y=lat, group = group),colour="black", fill="white")+
geom_point(data=resdf, aes(x=lon, y=lat), color='red')+
ggtitle('CONUS reservoir map')+
theme_bw()
print(p)
dev.off()
resdf$capture=apply(capture, MARGIN=1, FUN = sum)
resdf$release=apply(release, MARGIN=1, FUN = sum)
resdf$captures=apply(captures, MARGIN=1, FUN = sum)
resdf$sd_cap=apply(captures, MARGIN=1, FUN = sd)
resdf$max_capture=apply(capture, MARGIN=1, FUN = max)
resdf$max_release=-apply(release, MARGIN=1, FUN = min)
a=apply(capture, MARGIN=2, FUN = sum)
a=apply(abs(capture), MARGIN=2, FUN = sum)
which(abs(capture))=max(abs(capture))
which(abs(capture))==max(abs(capture))
which(abs(capture)==max(abs(capture))
)
which(a==max(a))
1994-1949
45*12
